<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Bolton Clinical Audio Guard</title>
    <style>
        body { 
            margin: 0; background-color: #000; color: #00ff00; 
            font-family: 'Courier New', Courier, monospace;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            height: 100vh; overflow: hidden;
            transition: background-color 0.3s;
        }
        #status { font-size: 2rem; margin-bottom: 20px; }
        #meter-container { width: 300px; height: 30px; border: 2px solid #00ff00; position: relative; }
        #meter-bar { width: 0%; height: 100%; background-color: #00ff00; transition: width 0.1s; }
        .boosted { background-color: #440000; color: #ff0000; border-color: #ff0000; }
        #info { margin-top: 20px; color: #888; text-align: center; }
        button { 
            padding: 15px 30px; font-size: 1.2rem; cursor: pointer;
            background: #00ff00; color: #000; border: none; font-weight: bold;
        }
    </style>
</head>
<body>

    <div id="status">ëŒ€ê¸° ì¤‘...</div>
    
    <div id="meter-container">
        <div id="meter-bar"></div>
    </div>

    <div id="info">
        <p>1ì´ˆ ì´ìƒ ì†ŒìŒ ì§€ì† ì‹œ ë°°ê²½ìƒ‰ì´ ë³€í•˜ë©° ê²½ê³ í•©ë‹ˆë‹¤.</p>
        <button id="start-btn">ì—”ì§„ ì‹œì‘</button>
    </div>

    <script>
        // ì„¤ì •ê°’
        const THRESHOLD = 0.01; // ê°ë„ (ë‚®ì„ìˆ˜ë¡ ì˜ˆë¯¼í•¨)
        const SUSTAIN_TIME = 1000; // 1ì´ˆ
        
        let isBoosted = false;
        let noiseStartTime = 0;

        const statusText = document.getElementById('status');
        const meterBar = document.getElementById('meter-bar');
        const startBtn = document.getElementById('start-btn');

        startBtn.onclick = async () => {
            startBtn.style.display = 'none';
            statusText.innerText = "ëª¨ë‹ˆí„°ë§ ì¤‘...";
            
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                const audioContext = new AudioContext();
                const source = audioContext.createMediaStreamSource(stream);
                const analyser = audioContext.createAnalyser();
                analyser.fftSize = 256;
                source.connect(analyser);

                const dataArray = new Uint8Array(analyser.frequencyBinCount);

                function checkNoise() {
                    analyser.getByteFrequencyData(dataArray);
                    let sum = 0;
                    for (let i = 0; i < dataArray.length; i++) {
                        sum += dataArray[i];
                    }
                    let average = sum / dataArray.length / 255; // 0 ~ 1 ì‚¬ì´ ê°’

                    // ì‹œê°ì  ê²Œì´ì§€ ì—…ë°ì´íŠ¸
                    meterBar.style.width = (average * 1000) + "%";

                    if (average > THRESHOLD) {
                        if (noiseStartTime === 0) noiseStartTime = Date.now();
                        let duration = Date.now() - noiseStartTime;

                        if (!isBoosted && duration >= SUSTAIN_TIME) {
                            activateBoost();
                        }
                    } else {
                        if (isBoosted) {
                            deactivateBoost();
                        }
                        noiseStartTime = 0;
                    }
                    requestAnimationFrame(checkNoise);
                }

                checkNoise();
            } catch (err) {
                alert("ë§ˆì´í¬ ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤: " + err);
            }
        };

        function activateBoost() {
            isBoosted = true;
            document.body.classList.add('boosted');
            statusText.innerText = "ğŸ“¢ ì†ŒìŒ ê°ì§€! (ë³¼ë¥¨ UP ìš”ì²­)";
            // ì—¬ê¸°ì„œ ì‹¤ì œ ìŠ¤í”¼ì»¤ë¡œ "ë³¼ë¥¨ì„ ë†’ì´ì„¸ìš”"ë¼ëŠ” ì•Œë¦¼ìŒì„ ì¬ìƒí•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.
        }

        function deactivateBoost() {
            isBoosted = false;
            document.body.classList.remove('boosted');
            statusText.innerText = "ëª¨ë‹ˆí„°ë§ ì¤‘...";
        }
    </script>
</body>
</html>
